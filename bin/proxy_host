#! /bin/bash

hostname=$1
proxy=$2

proxy_ip() {
  ip=$1
  iptables -t nat -A OUTPUT -d $ip -j DNAT --to-destination $proxy
}

if [ -z $proxy ]; then
  proxy="127.0.0.1:8080"
fi

ips=`host $hostname | grep "has address" | awk '{print $4}'`

if [[ ! -z $ips ]]; then
  for ip_addr in $ips; do
    proxy_ip $ip_addr
  done
else
  proxy_ip $hostname
fi
